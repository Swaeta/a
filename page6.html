<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>MAP</title>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <style></style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"
    />

    <meta
      name="viewport"
      content="width=device-width,
                    initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <script>
      L_NO_TOUCH = false;
      L_DISABLE_3D = false;
    </script>

    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: rgb(16, 3, 46);
      }
      #map {
        position: absolute;
        z-index: 0;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        margin: 0 2rem;
        margin-top: 8rem;
        margin-bottom: 1rem;
      }
      .nav {
        top: 0;
        height: 4rem;
        width: 100%;
        display: flex;
        z-index: 99;
        margin: 2rem 10px;
        font-size: 12px;
        font-weight: 700;
        color: rgb(220, 248, 255);
        margin-top: 2rem;
      }

      .nav_link {
        display: flex;
        font-weight: 300;
        font-size: 17px;
        color: rgb(229, 234, 236);
        position: relative;
        padding: 5px 0;
        overflow: hidden;
        text-decoration: none;
        text-transform: uppercase;
        transition: 0.3s;
        cursor: pointer;
        margin: 0.5rem 2rem;
      }

      .nav_link::before {
        content: "";
        position: absolute;
        bottom: 0;
        right: 100%;
        width: 50%;
        height: 2px;
        background: rgb(16, 140, 156);
        transition: 0.5s cubic-bezier(0.075, 0.82, 0.165, 1);
      }

      .nav_link::after {
        content: "";
        position: absolute;
        top: 0;
        left: 100%;
        width: 50%;
        height: 2px;
        background: rgb(16, 140, 156);
        transition: 0.5s cubic-bezier(0.075, 0.82, 0.165, 1);
      }

      .nav_link:hover {
        color: rgb(16, 140, 156);
      }

      .nav_link:hover::before {
        right: 0;
      }

      .nav_link:hover::after {
        left: 0;
      }
      .sidebar {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 15;
        top: 0;
        left: 0;
        background-color: rgb(16, 3, 46);
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
      }

      .sidebar a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #fff;
        display: block;
        transition: 0.3s;
      }

      .sidebar a:hover {
        color: #f1f1f1;
      }

      .sidebar .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
      }

      .openbtn {
        font-size: 20px;
        cursor: pointer;
        background-color: rgb(16, 3, 46);
        color: none;
        padding: 1px 15px;
        border: none;
      }

      #main {
        transition: margin-left 0.5s;
        padding: 16px;
      }

      /* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
      @media screen and (max-height: 450px) {
        .sidebar {
          padding-top: 15px;
        }
        .sidebar a {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
      <a href="#">About</a>
      <a href="#">Services</a>
      <a href="#">Clients</a>
      <a href="#">Contact</a>
    </div>

    <div id="main">
      <button class="openbtn" onclick="openNav()">
        <img src="./icons/menu.png" alt="a" style="width: 50px" />
      </button>
    </div>

    <script>
      function openNav() {
        document.getElementById("mySidebar").style.width = "250px";
        document.getElementById("main").style.marginLeft = "250px";
      }

      function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
      }
    </script>
    <div
      class="folium-map leaflet-container leaflet-fade-anim leaflet-grab leaflet-touch-drag"
      id="map"
      tabindex="0"
    >
      <div
        class="leaflet-pane leaflet-map-pane"
        style="transform: translate3d(-317px, -44px, 0px)"
      >
        <div class="leaflet-pane leaflet-tile-pane">
          <div class="leaflet-layer" style="z-index: 1; opacity: 1">
            <div
              class="leaflet-tile-container leaflet-zoom-animated"
              style="
                z-index: 16;
                transform: translate3d(1083px, 407px, 0px) scale(0.25);
              "
            ></div>
            <div
              class="leaflet-tile-container leaflet-zoom-animated"
              style="
                z-index: 18;
                transform: translate3d(0px, 0px, 0px) scale(1);
              "
            >
              <img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/3/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(640px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/4/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(896px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/3/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(640px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/4/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(896px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/3/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(640px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/4/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(896px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/2/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(384px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/5/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1152px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/2/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(384px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/5/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1152px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/2/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(384px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/5/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1152px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/3/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(640px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/4/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(896px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/3/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(640px, 855px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/4/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(896px, 855px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/2/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(384px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/5/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1152px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/1/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(128px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/6/3.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1408px, 343px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/2/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(384px, 855px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/5/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1152px, 855px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/1/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(128px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/6/2.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1408px, 87px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/1/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(128px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/6/4.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1408px, 599px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/1/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(128px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://b.tile.openstreetmap.org/3/6/1.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1408px, -169px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://a.tile.openstreetmap.org/3/1/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(128px, 855px, 0px);
                  opacity: 1;
                "
              /><img
                alt=""
                role="presentation"
                src="https://c.tile.openstreetmap.org/3/6/5.png"
                class="leaflet-tile leaflet-tile-loaded"
                style="
                  width: 256px;
                  height: 256px;
                  transform: translate3d(1408px, 855px, 0px);
                  opacity: 1;
                "
              />
            </div>
          </div>
        </div>
        <div class="leaflet-pane leaflet-shadow-pane"></div>
        <div class="leaflet-pane leaflet-overlay-pane">
          <svg
            pointer-events="none"
            class="leaflet-zoom-animated"
            width="1572"
            height="1020"
            viewBox="186 -41 1572 1020"
            style="transform: translate3d(186px, -41px, 0px)"
          >
            <g>
              <path
                class="leaflet-interactive"
                stroke="blue"
                stroke-opacity="1"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
                d="M1351 524L1353 524"
              ></path>
            </g>
          </svg>
        </div>
        <div class="leaflet-pane leaflet-marker-pane">
          <img
            src="https://cdn0.iconfinder.com/data/icons/geo-points/154/bus-512.png"
            class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive"
            alt=""
            tabindex="0"
            style="
              margin-left: -18.5px;
              margin-top: -18.5px;
              width: 37px;
              height: 37px;
              transform: translate3d(1353px, 524px, 0px);
              z-index: 524;
              outline: none;
            "
          />
        </div>
        <div class="leaflet-pane leaflet-tooltip-pane"></div>
        <div class="leaflet-pane leaflet-popup-pane">
          <div
            class="leaflet-popup leaflet-zoom-animated"
            style="
              opacity: 1;
              transform: translate3d(1353px, 524px, 0px);
              bottom: -7px;
              left: -73px;
            "
          >
            <div class="leaflet-popup-content-wrapper">
              <div class="leaflet-popup-content" style="width: 106px">
                Rajakadai Bus Stop
              </div>
            </div>
            <div class="leaflet-popup-tip-container">
              <div class="leaflet-popup-tip"></div>
            </div>
            <a class="leaflet-popup-close-button" href="#close">×</a>
          </div>
        </div>
        <div
          class="leaflet-proxy leaflet-zoom-animated"
          style="transform: translate3d(1100px, 894px, 0px) scale(4)"
        ></div>
      </div>
      <div class="leaflet-control-container">
        <div class="leaflet-top leaflet-left">
          <div class="leaflet-control-zoom leaflet-bar leaflet-control">
            <a
              class="leaflet-control-zoom-in"
              href="#"
              title="Zoom in"
              role="button"
              aria-label="Zoom in"
              >+</a
            ><a
              class="leaflet-control-zoom-out"
              href="#"
              title="Zoom out"
              role="button"
              aria-label="Zoom out"
              >−</a
            >
          </div>
        </div>
        <div class="leaflet-top leaflet-right"></div>
        <div class="leaflet-bottom leaflet-left"></div>
        <div class="leaflet-bottom leaflet-right">
          <div class="leaflet-control-attribution leaflet-control">
            <a
              href="https://leafletjs.com"
              title="A JS library for interactive maps"
              >Leaflet</a
            >
            | Data by © <a href="http://openstreetmap.org">OpenStreetMap</a>,
            under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.
          </div>
        </div>
      </div>
    </div>

    <script>
      from_data = [13.1511559, 80.2997199];
    </script>
    <script>
      var map = L.map("map", {
        center: from_data,
        crs: L.CRS.EPSG3857,
        zoom: 17,
        zoomControl: true,
        preferCanvas: false,
      });

      //L.circle(from_data, 500).addTo(map);

      var tile_layer_49c60ddf28d54ac3aad87eae9fd0ba57 = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution:
            'Data by \u0026copy; \u003ca href="http://openstreetmap.org"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href="http://www.openstreetmap.org/copyright"\u003eODbL\u003c/a\u003e.',
          detectRetina: false,
          maxNativeZoom: 18,
          maxZoom: 18,
          minZoom: 0,
          noWrap: false,
          opacity: 1,
          subdomains: "abc",
          tms: false,
        }
      ).addTo(map);
    </script>

    <canvas id="cnv" width="30" height="30" hidden=""></canvas>
    <script>
      Tw = 30;
      Th = 30;
      Rw = Tw / 30;
      Rh = Th / 30;
      var canvas = document.getElementById("cnv");
      canvas.width = Tw;
      canvas.height = Th;
      var ctx = canvas.getContext("2d");
    </script>
    <script>
      function drawEllipseByCenter(ctx, cx, cy, w, h, c = "white") {
        drawEllipse(ctx, cx - w / 2.0, cy - h / 2.0, w, h, c);
      }

      function drawEllipse(ctx, x, y, w, h, c = "white") {
        var kappa = 0.5522848,
          ox = (w / 2) * kappa, // control point offset horizontal
          oy = (h / 2) * kappa, // control point offset vertical
          xe = x + w, // x-end
          ye = y + h, // y-end
          xm = x + w / 2, // x-middle
          ym = y + h / 2; // y-middle

        ctx.beginPath();
        ctx.moveTo(x, ym);
        ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);
        ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);
        ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);
        ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);
        //ctx.closePath(); // not used correctly, see comments (use to close off open path)
        ctx.fillStyle = c;
        ctx.fill();
        ctx.stroke();
      }
      function r(ctx, x, y, w, h, bc, fc) {
        ctx.beginPath();
        ctx.fillStyle = fc;
        ctx.fillRect(x * Rw, y * Rh, w * Rw, h * Rh);
        ctx.rect(x * Rw, y * Rh, w * Rw, h * Rh);
        ctx.strokeStyle = bc;
        ctx.stroke();
      }

      function t(ctx, text, x, y, s, c = "black") {
        ctx.font = s * Rw + "px Monospace";
        ctx.fillStyle = c;
        ctx.textAlign = "center";
        ctx.fillText(text, x, y);
      }

      function bt(ctx, text, c = "black") {
        if (text.length == 1 || text.length == 2) {
          // RouteNo = '1'
          // RouteNo = '1B'
          t(ctx, text, canvas.width / 2, 15.85 * Rw, 18.9, c);
        } else if (text.length == 3) {
          // RouteNo = '101'
          t(ctx, text, canvas.width / 2, 14 * Rw, 15, c);
        } else if (text.length == 4) {
          // RouteNo = '159A'
          t(ctx, text, canvas.width / 2, 12.5 * Rw, 10, c);
        }
      }
    </script>
    <script>
      function iconlogo(
        populationOfBus = "low" || "medium" || "high",
        busBoard = "white" || "green" || "deluxe",
        routeNo,
        busStatus = "available" || "standing",
        seats
      ) {
        if (populationOfBus == "low") {
          // low
          r(ctx, 0, 0, 30, 30, "black", "#00FF00");
        } else if (populationOfBus == "medium") {
          // medium
          r(ctx, 0, 0, 30, 30, "black", "yellow");
        } else if (populationOfBus == "high") {
          // high
          r(ctx, 0, 0, 30, 30, "black", "red");
        }

        if (busBoard == "white") {
          // white board
          r(ctx, 3, 3, 24, 13, "black", "white");
          bt(ctx, routeNo);
        } else if (busBoard == "green") {
          // green board
          r(ctx, 3, 3, 24, 13, "black", "green");
          bt(ctx, routeNo, "white");
        } else if (busBoard == "deluxe") {
          //  deluxe
          r(ctx, 3, 3, 24, 13, "black", "black");
          bt(ctx, routeNo, "orange");
        }

        //drawEllipseByCenter(ctx, canvas.width / 2, 23 * Rh, 20 * Rw, 10 * Rh);

        if (busStatus == "available") {
          // no. of seats available
          t(ctx, seats, canvas.width / 2, 26.3 * Rh, 10, "blue");
        } else if (busStatus == "standing") {
          // no. of people standing
          t(ctx, seats, canvas.width / 2, 26.3 * Rh, 10, "red");
        }

        canvasToImg = canvas.toDataURL("image/png");

        return canvasToImg;
      }
      //iconlogo(populationOfBus = 'low' || 'medium' || 'high', busBoard = 'white' || 'green' || 'deluxe', routeNo, busStatus = 'available' ||'standing', seats)
    </script>

    <script>
      var markers = [];
      function createMarker(
        coords,
        id,
        details = "",
        draggable = false,
        type = false
      ) {
        var markerOptions = {
          draggable: draggable,
        };
        if (type) {
          if (type == "bus_stop") {
            image_url =
              "https://cdn0.iconfinder.com/data/icons/geo-points/154/bus-512.png";
          } else {
            image_url = iconlogo(type[0], type[1], type[2], type[3], type[4]);
          }
          var iconOptions = {
            iconUrl: image_url,
            iconSize: [37, 37],
          };
          var customIcon = L.icon(iconOptions);

          markerOptions = {
            icon: customIcon,
          };
        }
        var myMarker = L.marker(coords, markerOptions);
        myMarker._id = id;
        if (details != "") {
          var popupContent = details;
          var myPopup = myMarker.bindPopup(popupContent, {
            closeButton: true,
          });
        }
        map.addLayer(myMarker);
        markers.push(myMarker);
      }

      function clearMarker(id) {
        console.log(markers);
        var new_markers = [];
        markers.forEach(function (marker) {
          if (marker._id == id) map.removeLayer(marker);
          else new_markers.push(marker);
        });
        markers = new_markers;
      }

      function setLatLng(id, coords) {
        markers.forEach(function (marker) {
          if (marker._id == id) {
            marker.setLatLng(coords);
            return 1;
          }
        });
        return 0;
      }

      function changepopup(id, details) {
        markers.forEach(function (marker) {
          if (marker._id == id) {
            var popupContent = details;
            var myPopup = marker.bindPopup(popupContent, {
              closeButton: true,
            });
            return 1;
          }
        });
        return 0;
      }

      function changeicon(id, type) {
        markers.forEach(function (marker) {
          if (marker._id == id) {
            image_url = iconlogo(type[0], type[1], type[2], type[3], type[4]);

            var iconOptions = {
              iconUrl: image_url,
              iconSize: [37, 37],
            };
            var customIcon = L.icon(iconOptions);
            marker.setIcon(customIcon);
            return 1;
          }
        });
        return 0;
      }
    </script>
    <script>
      array_bus_location = [
        [13.172282908226636, 80.30534807971516],
        [13.172262015121383, 80.30528638890891],
        [13.172123598254007, 80.3052542024013],
        [13.172087035294835, 80.30523810914748],
        [13.172073977093813, 80.30524883798336],
        [13.171985181308365, 80.30521396926676],
        [13.171828482784903, 80.30518178275916],
        [13.17179191978166, 80.30517373613226],
        [13.171656114283746, 80.30512545636729],
        [13.171481134024146, 80.30506912997897],
        [13.171397561318715, 80.30506108335207],
        [13.171300930335523, 80.30503426125925],
        [13.171165124574753, 80.30499402812474],
        [13.170971862400702, 80.30494574836332],
        [13.170892149960007, 80.30492254123953],
        [13.170378788896159, 80.3048147863238],
        [13.170198924911144, 80.30477245403547],
        [13.170090257010289, 80.30473012174322],
        [13.169685562381312, 80.30463776038687],
        [13.16953567531196, 80.30461082165793],
        [13.169235900884402, 80.30450306673767],
        [13.168846193597627, 80.30442609894071],
        [13.168643845338725, 80.3043606763133],
        [13.168430255310499, 80.3043298891899],
        [13.1678456922112, 80.30414516647429],
        [13.167388532917645, 80.30402586638462],
        [13.16653416737288, 80.30380650816075],
        [13.166185675305, 80.30369875324405],
        [13.16587090784791, 80.30364487578552],
        [13.165496493326344, 80.30352002077457],
        [13.165214428428273, 80.30349319868317],
        [13.164728649248346, 80.30338054590653],
        [13.164556275753132, 80.30336445265159],
        [13.164410019364352, 80.3033483593978],
        [13.16398692003369, 80.30336445265159],
        [13.163872004027981, 80.30335372381485],
        [13.16368395955825, 80.30334835939692],
        [13.163464574145783, 80.30332690172386],
        [13.16329219976738, 80.30330544405211],
        [13.163109378324396, 80.30329471521624],
        [13.1626497123656, 80.30321424894295],
        [13.162498231353865, 80.303128418256],
        [13.149619388266737, 80.29888025993847],
        [13.149280227558242, 80.29878220142791],
        [13.149092171894013, 80.29873928608444],
        [13.148977248917115, 80.29867491306922],
        [13.148945906277708, 80.29867491306922],
        [13.148392185654382, 80.29847106518767],
        [13.147702645017374, 80.29813847127568],
        [13.147040247383552, 80.29788780419497],
      ];
    </script>
    <script>
      //getJSON
      var getJSON = function (url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.responseType = "json";
        xhr.onload = function () {
          var status = xhr.status;
          //alert(status);
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
        xhr.send();
      };
      // bus stops
      createMarker(from_data, "-1", "Rajakadai Bus Stop", 0, "bus_stop");
      //linepoly = L.polyline(array_bus_location, {color: 'blue'});
      //map.addLayer(linepoly);
      //map.setView(new L.LatLng(array_bus_location[5][0], array_bus_location[4][1]), 17);
      var oldlocation = [0, 0, 0];
      //setInterval(
      //   function () {
      getJSON(
        "https://pkamalesh1132.pythonanywhere.com/page33/?thispage",
        function (err, data) {
          if (err !== null) {
            alert("Something went wrong: " + err);
          } else {
            //alert([data['feeds'][0]['field1'],data['feeds'][0]['field2'],data['feeds'][0]['created_at']]);
            array_bus_location = [];
            for (i = oldlocation[2]; i < data["details"].length; i++) {
              array_bus_location[i] = [
                data["details"][i][1],
                data["details"][i][2],
              ];

              //createMarker(array_bus_location[i], i, data['details'][i][0], 0, 'bus_stop');
            }
            oldlocation[2] = data["details"].length;
            i = i - 1;
            //alert();
            if (
              oldlocation[0] != data["details"][i][1] &&
              oldlocation[1] != data["details"][i][2]
            ) {
              map.panTo(
                new L.LatLng(data["details"][i][1], data["details"][i][2])
              );
              oldlocation[0] = data["details"][i][1];
              oldlocation[1] = data["details"][i][2];
            }
            //alert(array_bus_location);
            linepoly = L.polyline(array_bus_location, { color: "blue" });
            map.addLayer(linepoly);
          }
        }
      );
      //    }, 1000
      //);

      /*
    setInterval(function () {
       getJSON('https://api.thingspeak.com/channels/1639346/feeds.json?api_key=OAHQ0G30LWJKQOQB&results=1',
        function(err, data) {
          if (err !== null) {
            alert('Something went wrong: ' + err);
          } else {
              //alert([data['feeds'][0]['field1'],data['feeds'][0]['field2'],data['feeds'][0]['created_at']]);
              setLatLng('-1', [data['feeds'][0]['field1'],data['feeds'][0]['field2']]);
              map.setView(new L.LatLng(data['feeds'][0]['field1'],data['feeds'][0]['field2']), 17);
          }
        });
    }, 1000
        );
        */
    </script>
    <script>
      /*
    color_route_list = ['blue', 'mediumvioletred', 'deepskyblue', 'deeppink', 'forestgreen', 'goldenrod',];
    showing_buses_number = document.getElementById('showing_buses_number');
    showing_routes_number = document.getElementById('showing_routes_number');
    value_showing_routes_number = 1
    if(value_showing_routes_number = 1){
        temp_showing_routes_number = ' route';
    }
    else{
        temp_showing_routes_number = ' routes';
    }
    showing_routes_number.innerHTML = value_showing_routes_number + ' ' + temp_showing_routes_number;
    showing_routes_color = document.getElementById('showing_routes_color');
    showing_routes_color_string = '';
    for(i=0;i<color_route_list.length;i++){
        showing_routes_color_string += '<b style="padding:0px 20px; color:' + color_route_list[i] + ';">#' + (i+1) + ' ' + color_route_list[i] + '</b><br><hr>';
    }
    showing_routes_color.innerHTML = showing_routes_color_string;
*/
    </script>
    <form method="post" id="saveForNext" hidden="" action="/page6/"></form>
    <script>
      /*
    function funTicketBooked(RouteNo, Board, Departure, DateMonth, FromStop, TravelDuration, ToDateMonth, ToStop, Fare, SeatsAvailability, SeatsOccupied, Standing, BusId, this_other_side){
        //alert([RouteNo, Board, Departure, DateMonth, FromStop, TravelDuration, ToDateMonth, ToStop, Fare, SeatsAvailability, SeatsOccupied, Standing, BusId, this_other_side])
        array = ['routeNumber','board','departure','dateMonth','fromStop','travelDuration','todateMonth','toStop','fare','seatsAvailable','seatsOccupied','standing','busid','this_other_side'];
        if(Board == 'white')
            Board = 0
        else if(Board == 'green')
            Board = 1
        else if(Board == 'deluxe')
            Board = 2
        if(SeatsAvailability == 'no')
            SeatsAvailability = 0
        if(SeatsOccupied == 'no')
            SeatsOccupied = 0
        if(Standing == 'no')
            Standing = 0
        array_book = [RouteNo, Board, Departure, DateMonth, FromStop, TravelDuration, ToDateMonth, ToStop, Fare, SeatsAvailability, SeatsOccupied, Standing, BusId, this_other_side];
        //alert(array_book)
        saveForNext = document.getElementById('saveForNext');
        saveStr = '<input type="hidden" name="csrfmiddlewaretoken" value="pDjl6Rhk5Z8PWCySHeH6N44WfehxJdg7uA3NNMV6HuuUlAH91N9j1gOqb66ReasD">';
        for(i=0; i<array_book.length; i++){
            saveStr += '<input value="' + array_book[i] + '" name="' + array[i] + '"/>';
        }
        saveStr += '<button id="saveForNextButton" type="submit"></button>';
        saveForNext.innerHTML = saveStr;
        document.getElementById('saveForNextButton').click();
    }
    function funTicketBookedClicked(thisEvent){
        base = thisEvent.parentElement.children[0];
        RouteNo = base.children[0].innerHTML;
        Board = base.children[1].innerHTML;
        BusId = base.children[2].innerHTML;
        Fare = base.children[3].children[0].innerHTML;
        Departure = base.children[4].children[0].innerHTML;
        Arrival = base.children[5].children[0].innerHTML;
        SeatsAvailability = base.children[6].children[0].innerHTML;
        SeatsOccupied = base.children[7].children[0].innerHTML;
        Standing = base.children[8].children[0].innerHTML;
        this_other_side = thisEvent.parentElement.children[1].innerHTML;
        DateMonth = '20 Nov';
        ToDateMonth = '20 Nov';
        FromStop = from_stop;
        ToStop = to_stop;
        TravelDuration = '10 min';
        funTicketBooked(RouteNo, Board, Departure, DateMonth, FromStop, TravelDuration, ToDateMonth, ToStop, Fare, SeatsAvailability, SeatsOccupied, Standing, BusId, this_other_side);
    }
    */
    </script>
    <script>
      /*
    // bus moving
    myarray = [from_data,[from_data[0],to_data[1]],[from_data[0]+0.001*500,to_data[1]],to_data,[to_data[0],from_data[1]],to_data,from_data,[to_data[0],from_data[1]]];
    mycount = 0;
    BusIdKam = [];
    board_color = {'white' : '#7E7E8C', 'green' : 'green', 'deluxe' : 'orange'};
    cent = 0;
    popup_general = ['BusId', 'RouteNo', 'Board', 'Latitude', 'Longitude', 'seats_available', 'seats_occupied', 'standing'];
    function popupdetailsformarker(BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing, fare, this_other_side){
        return '<div style="font-size: 14px;color: rgb(126, 126, 140);">'
                + '<h3 style="margin:0; color:rgb(62, 62, 82);" id="' + popup_general[1] + '_' + BusId + '">' + RouteNo + '</h3>'
                + '<p style="margin:0; font-weight: bold; color:' + board_color[Board] + ';" id="' + popup_general[2] + '_' + BusId + '">' + Board + '</p>'
                + '<b style="margin:0; color:#7E7E8C;" id="' + popup_general[0] + '_' + BusId + '">' + BusId + '</b>'
                + '<p style="margin:0;">Fare: <b id="' + 'Fare' + '_' + BusId + '">' + fare + '</b></p>'
                + '<p style="margin:0;">Estimated Departure: <b id="' + 'Departure' + '_' + BusId + '">20:00</b></p>'
                + '<p style="margin:0;">Estimated Arrival: <b id="' + 'Arrival' + '_' + BusId + '">20:10</b></p>'
                + '<div><b style="color:rgb(62, 62, 82);" id="' + popup_general[5] + '_' + BusId + '">' + seats_available + '</b> seats available</div>'
                + '<div><b style="font-weight: normal;" id="' + popup_general[6] + '_' + BusId + '">' + seats_occupied + '</b> tickets occupied</div>'
                + '<div><b style="font-weight: normal;" id="' + popup_general[7] + '_' + BusId + '">' + standing + '</b> people standing</div></div>'
                + '<div hidden>' + this_other_side + '</div>'
                + '<button style="font-size: 14px;color: white;padding: 3px 75px;background-color: dodgerblue;border-radius: 5px;border: unset;user-select: auto;" onclick=funTicketBookedClicked(this)>Book</button>'
                ;
    }
    function changePopup(BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing, fare, this_other_side){
        id = BusId;
        try{
            document.getElementById(popup_general[5] + '_' + id).innerHTML = seats_available;
            document.getElementById(popup_general[6] + '_' + id).innerHTML = seats_occupied;
            document.getElementById(popup_general[7] + '_' + id).innerHTML = standing;
            document.getElementById('Departure' + '_' + id).innerHTML = '19:50';
            document.getElementById('Arrival' + '_' + id).innerHTML = '20:00';
        }
        catch{
            details = popupdetailsformarker(BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing, fare, this_other_side);
            //alert(details)
            changepopup(id, details);
        }
    }
    //iconlogo(populationOfBus = 'low' || 'medium' || 'high', busBoard = 'white' || 'green' || 'deluxe', routeNo, busStatus = 'available' || 'standing', seats)
    function generate_icon_details(Board, RouteNo, seats_available, seats_occupied, standing){
        busBoard = Board;
        routeNo = RouteNo;
        if(seats_available == 'no'){
            busStatus = 'standing';
            seats = standing;
        }
        else{
            busStatus = 'available';
            seats = seats_available;
        }
        if(seats_available == 'no' && (standing == 'no' || standing <= 10)){
            populationOfBus = 'medium';
        }
        else if(standing > 10){
            populationOfBus = 'high';
        }
        else{
            populationOfBus = 'low';
        }
        return [populationOfBus, busBoard, routeNo, busStatus, seats]
    }
    function otherfunction(value){
        //alert(value);
        //create -> BusIdKam[BusIdKam.length];createMarker(from_data, 1, from_details, 0, ['high', 'deluxe', '1A', 'available', '10']);
        //delete -> BusIdKam.splice(i, 1); clearMarker(id);
        //sustain -> setLatLng(3, [Lat, Lng]); myMarker.bindPopup;

        // create
        if(value.length==1)
            temp_showing_buses_number = 'bus';
        else
            temp_showing_buses_number = 'buses';
        showing_buses_number.innerHTML = value.length + ' ' + temp_showing_buses_number;
        for(i=0; i<value.length; i++){
            boolean = 1; // new entry
            for(j=0; j<BusIdKam.length; j++){
                if(BusIdKam[j]==value[i][0]){
                    boolean = 0; // already there
                    break;
                }
            }
            if(boolean){// create
                BusIdKam[BusIdKam.length] = value[i][0];
                //BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing
                BusId = value[i][0];
                RouteNo = value[i][1];
                Board = value[i][2];
                Latitude = value[i][3];
                Longitude = value[i][4];
                seats_available = value[i][5];
                seats_occupied = value[i][6];
                standing = value[i][7];
                details = popupdetailsformarker(BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing);
                //iconlogo(populationOfBus = 'low' || 'medium' || 'high', busBoard = 'white' || 'green' || 'deluxe', routeNo, busStatus = 'available' ||'standing', seats)
                createMarker(myarray[mycount], value[i][0], details, 0, generate_icon_details(Board, RouteNo, seats_available, seats_occupied, standing));
                mycount++;
                if(mycount>=6)
                    mycount = 0;
            }
        }

        //delete or sustain
        for(i=0; i<BusIdKam.length; i++){
            //alert([cent,BusIdKam]);
            boolean = 0; // delete
            for(j=0; j<value.length; j++){
                if(BusIdKam[i]==value[j][0]){
                    boolean = value[j]; // sustain
                    break;
                }
            }
            if(!boolean){ // delete
            //alert('delete')
                clearMarker(BusIdKam[i]);
                //alert([BusIdKam.length,value.length,BusIdKam[i],cent]);
                BusIdKam.splice(i, 1);
            }
            else{ // sustain
                setLatLng(boolean[0], myarray[mycount]);
                //BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing
                BusId = boolean[0];
                RouteNo = boolean[1];
                Board = boolean[2];
                Latitude = boolean[3];
                Longitude = boolean[4];
                seats_available = boolean[5];
                seats_occupied = boolean[6];
                standing = boolean[7];
                fare = boolean[8];
                this_other_side = boolean[9];
                changePopup(BusId, RouteNo, Board, Latitude, Longitude, seats_available, seats_occupied, standing, fare, this_other_side);
                changeicon(id, generate_icon_details(Board, RouteNo, seats_available, seats_occupied, standing));
                //alert(BusId)
                mycount++;
                if(mycount>=6)
                    mycount = 0;
                //myMarker.bindPopup;
            }
        }
        cent++;
    }
    var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function() {
          var status = xhr.status;
          //alert(status);
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
        xhr.send();
    };

    setInterval(function(){
    getJSON('https://pkamalesh1132.pythonanywhere.com/page15/?from=' + from_stop + '&to=' + to_stop,
    function(err, data) {
      if (err !== null) {
        //alert('Something went wrong: ' + err);
      } else {
        otherfunction(data['table3']);
      }
    });
    },
    1000
    )
*/
    </script>
  </body>
</html>
